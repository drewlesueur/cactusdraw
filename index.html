<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Canvas Draw</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
	<style>
	* {
		border: 0;
		margin: 0;
		padding: 0;
	}
	html, body {
		width: 100%;
		height: 100%;
		overflow: hidden;
	}
	</style>
</head>
<body>
<canvas id="canvas" width="100" height="100"><p>Your browser doesn't support canvas</p></canvas>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script>
	$(document).ready(function () {
		"use strict";

		var $window = $(window);

		var $canvas = $("#canvas");
		var canvas = $canvas.get(0);

		var ctx = canvas.getContext('2d');

		var draw = function (x1, y1, x2, y2) {
			ctx.beginPath();
			ctx.moveTo(x1, y1);
			ctx.lineTo(x2, y2);
			ctx.stroke();
		};

		// Offset the window drawing position by the canvas's position so it'll draw on the canvas
		var canvasLeft = canvas.offsetLeft;
		var canvasTop = canvas.offsetTop;

		// xPos and yPos are previous point, drawing is 'mouse or touch is down' e.g. currently drawing
		var drawing = false, xPos, yPos;

		var handleMove = function (x, y) {
			// Offset the window drawing position by the canvas's position so it'll draw on the canvas
			var x = x - canvasLeft,
				y = y - canvasTop;
			if (x === xPos && y === yPos) {
				return; // We're already there
			}

			if (!drawing) {
				drawing = true;
			} else {
				draw(xPos, yPos, x, y);
			}
			xPos = x;
			yPos = y;
		};

		if (Modernizr.touch) {
			// touch
			$canvas.bind('touchstart', function (e) {
				$canvas.bind('touchmove', function (event) {
					handleMove(event.touches[0].clientX, event.touches[0].clientY);
				});
			});
			$(document).bind('touchend', function (event) {
				$canvas.unbind('touchmove');
				drawing = false;
			});
		} else {
			// mouse
			$canvas.mousedown(function (e) {
				if (e.button === 0) {
					$canvas.bind('mousemove', function (event) {
						handleMove(event.clientX, event.clientY);
					});
				}
			});
			$(document).mouseup(function (event) {
				$canvas.unbind('mousemove');
				drawing = false;
			});
		}

		// If the window resizes, resize the canvas
		// FRAGILE: blanks the canvas in the process
		var resizeCanvas = function () {
			// Can't set $("#canvas").width() because jQuery is going to scale, not resize
			// TODO: capture data and write to avoid blanking on resize
			//var data = ctx.getImageData();
			canvas.width = $window.width();
			canvas.height = $window.height();
			//ctx.putImageData(data);
		};
		$window.resize(resizeCanvas);
		resizeCanvas();

	});
</script>
</body>
</html>
